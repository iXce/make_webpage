/*!
 * g.Raphael 0.51 - Charting library, based on RaphaÃ«l
 *
 * Copyright (c) 2009-2012 Dmitry Baranovskiy (http://g.raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
Raphael.el.popup=function(a,b,c,d){var e=this.paper||this[0].paper,f,g,h,i,j;if(!e)return;switch(this.type){case"text":case"circle":case"ellipse":h=true;break;default:h=false}a=a==null?"up":a;b=b||5;f=this.getBBox();c=typeof c=="number"?c:h?f.x+f.width/2:f.x;d=typeof d=="number"?d:h?f.y+f.height/2:f.y;i=Math.max(f.width/2-b,0);j=Math.max(f.height/2-b,0);this.translate(c-f.x-(h?f.width/2:0),d-f.y-(h?f.height/2:0));f=this.getBBox();var k={up:["M",c,d,"l",-b,-b,-i,0,"a",b,b,0,0,1,-b,-b,"l",0,-f.height,"a",b,b,0,0,1,b,-b,"l",b*2+i*2,0,"a",b,b,0,0,1,b,b,"l",0,f.height,"a",b,b,0,0,1,-b,b,"l",-i,0,"z"].join(","),down:["M",c,d,"l",b,b,i,0,"a",b,b,0,0,1,b,b,"l",0,f.height,"a",b,b,0,0,1,-b,b,"l",-(b*2+i*2),0,"a",b,b,0,0,1,-b,-b,"l",0,-f.height,"a",b,b,0,0,1,b,-b,"l",i,0,"z"].join(","),left:["M",c,d,"l",-b,b,0,j,"a",b,b,0,0,1,-b,b,"l",-f.width,0,"a",b,b,0,0,1,-b,-b,"l",0,-(b*2+j*2),"a",b,b,0,0,1,b,-b,"l",f.width,0,"a",b,b,0,0,1,b,b,"l",0,j,"z"].join(","),right:["M",c,d,"l",b,-b,0,-j,"a",b,b,0,0,1,b,-b,"l",f.width,0,"a",b,b,0,0,1,b,b,"l",0,b*2+j*2,"a",b,b,0,0,1,-b,b,"l",-f.width,0,"a",b,b,0,0,1,-b,-b,"l",0,-j,"z"].join(",")};g={up:{x:-!h*(f.width/2),y:-b*2-(h?f.height/2:f.height)},down:{x:-!h*(f.width/2),y:b*2+(h?f.height/2:f.height)},left:{x:-b*2-(h?f.width/2:f.width),y:-!h*(f.height/2)},right:{x:b*2+(h?f.width/2:f.width),y:-!h*(f.height/2)}}[a];this.translate(g.x,g.y);return e.path(k[a]).attr({fill:"#000",stroke:"none"}).insertBefore(this.node?this:this[0])};Raphael.el.tag=function(a,b,c,d){var e=3,f=this.paper||this[0].paper;if(!f)return;var g=f.path().attr({fill:"#000",stroke:"#000"}),h=this.getBBox(),i,j,k,l;switch(this.type){case"text":case"circle":case"ellipse":k=true;break;default:k=false}a=a||0;c=typeof c=="number"?c:k?h.x+h.width/2:h.x;d=typeof d=="number"?d:k?h.y+h.height/2:h.y;b=b==null?5:b;j=.5522*b;if(h.height>=b*2){g.attr({path:["M",c,d+b,"a",b,b,0,1,1,0,-b*2,b,b,0,1,1,0,b*2,"m",0,-b*2-e,"a",b+e,b+e,0,1,0,0,(b+e)*2,"L",c+b+e,d+h.height/2+e,"l",h.width+2*e,0,0,-h.height-2*e,-h.width-2*e,0,"L",c,d-b-e].join(",")})}else{i=Math.sqrt(Math.pow(b+e,2)-Math.pow(h.height/2+e,2));g.attr({path:["M",c,d+b,"c",-j,0,-b,j-b,-b,-b,0,-j,b-j,-b,b,-b,j,0,b,b-j,b,b,0,j,j-b,b,-b,b,"M",c+i,d-h.height/2-e,"a",b+e,b+e,0,1,0,0,h.height+2*e,"l",b+e-i+h.width+2*e,0,0,-h.height-2*e,"L",c+i,d-h.height/2-e].join(",")})}a=360-a;g.rotate(a,c,d);if(this.attrs){this.attr(this.attrs.x?"x":"cx",c+b+e+(!k?this.type=="text"?h.width:0:h.width/2)).attr("y",k?d:d-h.height/2);this.rotate(a,c,d);a>90&&a<270&&this.attr(this.attrs.x?"x":"cx",c-b-e-(!k?h.width:h.width/2)).rotate(180,c,d)}else{if(a>90&&a<270){this.translate(c-h.x-h.width-b-e,d-h.y-h.height/2);this.rotate(a-180,h.x+h.width+b+e,h.y+h.height/2)}else{this.translate(c-h.x+b+e,d-h.y-h.height/2);this.rotate(a,h.x-b-e,h.y+h.height/2)}}return g.insertBefore(this.node?this:this[0])};Raphael.el.drop=function(a,b,c){var d=this.getBBox(),e=this.paper||this[0].paper,f,g,h,i,j;if(!e)return;switch(this.type){case"text":case"circle":case"ellipse":f=true;break;default:f=false}a=a||0;b=typeof b=="number"?b:f?d.x+d.width/2:d.x;c=typeof c=="number"?c:f?d.y+d.height/2:d.y;g=Math.max(d.width,d.height)+Math.min(d.width,d.height);h=e.path(["M",b,c,"l",g,0,"A",g*.4,g*.4,0,1,0,b+g*.7,c-g*.7,"z"]).attr({fill:"#000",stroke:"none"}).rotate(22.5-a,b,c);a=(a+90)*Math.PI/180;i=b+g*Math.sin(a)-(f?0:d.width/2);j=c+g*Math.cos(a)-(f?0:d.height/2);this.attrs?this.attr(this.attrs.x?"x":"cx",i).attr(this.attrs.y?"y":"cy",j):this.translate(i-d.x,j-d.y);return h.insertBefore(this.node?this:this[0])};Raphael.el.flag=function(a,b,c){var d=3,e=this.paper||this[0].paper;if(!e)return;var f=e.path().attr({fill:"#000",stroke:"#000"}),g=this.getBBox(),h=g.height/2,i;switch(this.type){case"text":case"circle":case"ellipse":i=true;break;default:i=false}a=a||0;b=typeof b=="number"?b:i?g.x+g.width/2:g.x;c=typeof c=="number"?c:i?g.y+g.height/2:g.y;f.attr({path:["M",b,c,"l",h+d,-h-d,g.width+2*d,0,0,g.height+2*d,-g.width-2*d,0,"z"].join(",")});a=360-a;f.rotate(a,b,c);if(this.attrs){this.attr(this.attrs.x?"x":"cx",b+h+d+(!i?this.type=="text"?g.width:0:g.width/2)).attr("y",i?c:c-g.height/2);this.rotate(a,b,c);a>90&&a<270&&this.attr(this.attrs.x?"x":"cx",b-h-d-(!i?g.width:g.width/2)).rotate(180,b,c)}else{if(a>90&&a<270){this.translate(b-g.x-g.width-h-d,c-g.y-g.height/2);this.rotate(a-180,g.x+g.width+h+d,g.y+g.height/2)}else{this.translate(b-g.x+h+d,c-g.y-g.height/2);this.rotate(a,g.x-h-d,g.y+g.height/2)}}return f.insertBefore(this.node?this:this[0])};Raphael.el.label=function(){var a=this.getBBox(),b=this.paper||this[0].paper,c=Math.min(20,a.width+10,a.height+10)/2;if(!b)return;return b.rect(a.x-c/2,a.y-c/2,a.width+c,a.height+c,c).attr({stroke:"none",fill:"#000"}).insertBefore(this.node?this:this[0])};Raphael.el.blob=function(a,b,c){var d=this.getBBox(),e=Math.PI/180,f=this.paper||this[0].paper,g,h,i;if(!f)return;switch(this.type){case"text":case"circle":case"ellipse":h=true;break;default:h=false}g=f.path().attr({fill:"#000",stroke:"none"});a=(+a+1?a:45)+90;i=Math.min(d.height,d.width);b=typeof b=="number"?b:h?d.x+d.width/2:d.x;c=typeof c=="number"?c:h?d.y+d.height/2:d.y;var j=Math.max(d.width+i,i*25/12),k=Math.max(d.height+i,i*25/12),l=b+i*Math.sin((a-22.5)*e),m=c+i*Math.cos((a-22.5)*e),n=b+i*Math.sin((a+22.5)*e),o=c+i*Math.cos((a+22.5)*e),p=(n-l)/2,q=(o-m)/2,r=j/2,s=k/2,t=-Math.sqrt(Math.abs(r*r*s*s-r*r*q*q-s*s*p*p)/(r*r*q*q+s*s*p*p)),u=t*r*q/s+(n+l)/2,v=t*-s*p/r+(o+m)/2;g.attr({x:u,y:v,path:["M",b,c,"L",n,o,"A",r,s,0,1,1,l,m,"z"].join(",")});this.translate(u-d.x-d.width/2,v-d.y-d.height/2);return g.insertBefore(this.node?this:this[0])};Raphael.fn.label=function(a,b,c){var d=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return d.push(c.label(),c)};Raphael.fn.popup=function(a,b,c,d,e){var f=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return f.push(c.popup(d,e),c)};Raphael.fn.tag=function(a,b,c,d,e){var f=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return f.push(c.tag(d,e),c)};Raphael.fn.flag=function(a,b,c,d){var e=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return e.push(c.flag(d),c)};Raphael.fn.drop=function(a,b,c,d){var e=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return e.push(c.drop(d),c)};Raphael.fn.blob=function(a,b,c,d){var e=this.set();c=this.text(a,b,c).attr(Raphael.g.txtattr);return e.push(c.blob(d),c)};Raphael.el.lighter=function(a){a=a||2;var b=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[b[0],b[1]];b[0]=Raphael.rgb2hsb(Raphael.getRGB(b[0]).hex);b[1]=Raphael.rgb2hsb(Raphael.getRGB(b[1]).hex);b[0].b=Math.min(b[0].b*a,1);b[0].s=b[0].s/a;b[1].b=Math.min(b[1].b*a,1);b[1].s=b[1].s/a;this.attr({fill:"hsb("+[b[0].h,b[0].s,b[0].b]+")",stroke:"hsb("+[b[1].h,b[1].s,b[1].b]+")"});return this};Raphael.el.darker=function(a){a=a||2;var b=[this.attrs.fill,this.attrs.stroke];this.fs=this.fs||[b[0],b[1]];b[0]=Raphael.rgb2hsb(Raphael.getRGB(b[0]).hex);b[1]=Raphael.rgb2hsb(Raphael.getRGB(b[1]).hex);b[0].s=Math.min(b[0].s*a,1);b[0].b=b[0].b/a;b[1].s=Math.min(b[1].s*a,1);b[1].b=b[1].b/a;this.attr({fill:"hsb("+[b[0].h,b[0].s,b[0].b]+")",stroke:"hsb("+[b[1].h,b[1].s,b[1].b]+")"});return this};Raphael.el.resetBrightness=function(){if(this.fs){this.attr({fill:this.fs[0],stroke:this.fs[1]});delete this.fs}return this};(function(){var a=["lighter","darker","resetBrightness"],b=["popup","tag","flag","label","drop","blob"];for(var c in b)(function(a){Raphael.st[a]=function(){return Raphael.el[a].apply(this,arguments)}})(b[c]);for(var c in a)(function(a){Raphael.st[a]=function(){for(var b=0;b<this.length;b++){this[b][a].apply(this[b],arguments)}return this}})(a[c])})();Raphael.g={shim:{stroke:"none",fill:"#000","fill-opacity":0},txtattr:{font:"12px Arial, sans-serif",fill:"#fff"},colors:function(){var a=[.6,.2,.05,.1333,.75,0],b=[];for(var c=0;c<10;c++){if(c<a.length){b.push("hsb("+a[c]+",.75, .75)")}else{b.push("hsb("+a[c-a.length]+", 1, .5)")}}return b}(),snapEnds:function(a,b,c){function h(a){return Math.abs(a-.5)<.25?~~a+.5:Math.round(a)}var d=a,e=b;if(d==e){return{from:d,to:e,power:0}}var f=Math.log(d)/Math.log(10),g=Math.log(e-d)/Math.log(10);if(g<0&&f<g){a=d=0;g=Math.log(e-d)/Math.log(10)}if(g<0&&(1+g)%1>Math.log(.5)/Math.log(10)){b=e=d+Math.pow(10,Math.ceil(g))}var i=(e-d)/c,j=~~i,k=j,l=0;if(j){while(k){l--;k=~~(i*Math.pow(10,l))/Math.pow(10,l)}l++}else{if(i==0||!isFinite(i)){l=1}else{while(!j){l=l||1;j=~~(i*Math.pow(10,l))/Math.pow(10,l);l++}}l&&l--}e=h(b*Math.pow(10,l))/Math.pow(10,l);if(e<b){e=h((b+.5)*Math.pow(10,l))/Math.pow(10,l)}d=h((a-(l>0?0:.5))*Math.pow(10,l))/Math.pow(10,l);return{from:d,to:e,power:l}},axis:function(a,b,c,d,e,f,g,h,i,j,k){j=j==null?2:j;i=i||"t";f=f||10;k=arguments[arguments.length-1];var l=i=="|"||i==" "?["M",a+.5,b,"l",0,.001]:g==1||g==3?["M",a+.5,b,"l",0,-c]:["M",a,b+.5,"l",c,0],m=this.snapEnds(d,e,f),n=m.from,o=m.to,p=m.power,q=0,r={font:"11px 'Fontin Sans', Fontin-Sans, sans-serif"},s=k.set(),t;t=(o-n)/f;var u=n,v=p>0?p:0;z=c/f;if(+g==1||+g==3){var w=b,x=(g-1?1:-1)*(j+3+!!(g-1));while(w>=b-c){i!="-"&&i!=" "&&(l=l.concat(["M",a-(i=="+"||i=="|"?j:!(g-1)*j*2),w+.5,"l",j*2+1,0]));s.push(k.text(a+x,w,h&&h[q++]||(Math.round(u)==u?u:+u.toFixed(v))).attr(r).attr({"text-anchor":g-1?"start":"end"}));u+=t;w-=z}if(Math.round(w+z-(b-c))){i!="-"&&i!=" "&&(l=l.concat(["M",a-(i=="+"||i=="|"?j:!(g-1)*j*2),b-c+.5,"l",j*2+1,0]));s.push(k.text(a+x,b-c,h&&h[q]||(Math.round(u)==u?u:+u.toFixed(v))).attr(r).attr({"text-anchor":g-1?"start":"end"}))}}else{u=n;v=(p>0)*p;x=(g?-1:1)*(j+9+!g);var y=a,z=c/f,A=0,B=0;while(y<=a+c){i!="-"&&i!=" "&&(l=l.concat(["M",y+.5,b-(i=="+"?j:!!g*j*2),"l",0,j*2+1]));s.push(A=k.text(y,b+x,h&&h[q++]||(Math.round(u)==u?u:+u.toFixed(v))).attr(r));var C=A.getBBox();if(B>=C.x-5){s.pop(s.length-1).remove()}else{B=C.x+C.width}u+=t;y+=z}if(Math.round(y-z-a-c)){i!="-"&&i!=" "&&(l=l.concat(["M",a+c+.5,b-(i=="+"?j:!!g*j*2),"l",0,j*2+1]));s.push(k.text(a+c,b+x,h&&h[q]||(Math.round(u)==u?u:+u.toFixed(v))).attr(r))}}var D=k.path(l);D.text=s;D.all=k.set([D,s]);D.remove=function(){this.text.remove();this.constructor.prototype.remove.call(this)};return D},labelise:function(a,b,c){if(a){return(a+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(a,d,e){if(d){return(+b).toFixed(d.replace(/^#+\.?/g,"").length)}if(e){return(b*100/c).toFixed(e.replace(/^%+\.?/g,"").length)+"%"}})}else{return(+b).toFixed(0)}}}
